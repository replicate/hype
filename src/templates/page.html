<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hype - ML/AI News</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<style>
		body { font-family: Verdana, Geneva, sans-serif; }
	</style>
</head>
<body class="container mx-auto overflow-x-hidden">
	<main class="md:px-4">
		<div class="flex justify-between items-center bg-red-600 px-2 sm:px-4 py-2 text-[11px] sm:text-sm">
			<a href="/" class="text-white font-bold hover:underline rotate-[-5deg]">Hype</a>
			<a href="https://github.com/replicate/hype#readme" class="text-white ml-2 sm:ml-4 hover:underline" target="_blank">What is this?</a>
			<div class="flex items-center ml-auto">
				{{#filterLinks}}
				{{^first}}<span class="text-white mx-1 sm:mx-4">|</span>{{/first}}
				<a href="/?filter={{key}}&sources={{sourcesParam}}" class="text-white whitespace-nowrap {{#active}}underline{{/active}}" data-navigate>{{label}}</a>
				{{/filterLinks}}
			</div>
		</div>

		<div class="text-[10px] sm:text-xs flex flex-wrap justify-between items-center bg-[#f6f6ef] px-2 sm:px-4 py-1 gap-y-1">
			<div class="flex items-center flex-wrap gap-x-2 sm:gap-x-4 gap-y-1">
				{{#sources}}
				<label class="inline-flex items-center cursor-pointer">
					<input type="checkbox" class="form-checkbox accent-gray-600" data-source="{{name}}" {{#checked}}checked{{/checked}}>
					<span class="ml-1 sm:ml-2">{{name}}</span>
				</label>
				{{/sources}}
			</div>
			<span class="text-gray-500">Updated <span id="last-updated"></span></span>
		</div>

		<ul class="bg-gray-100 relative">
			{{#posts}}
			<li class="flex py-1 bg-[#f6f6ef] px-2 sm:px-0">
				<span class="w-6 sm:w-8 text-right mr-1 sm:mr-2 text-gray-600 text-xs sm:text-base shrink-0">{{index}}.</span>
				<div class="flex flex-col min-w-0">
					<div class="text-[13px] sm:text-[0.9rem]">
						<a href="{{url}}" target="_blank" rel="noopener noreferrer" class="text-black break-words">{{displayName}}</a>
						<span class="text-gray-600 text-xs ml-1">{{icon}} {{stars}}</span>
					</div>
					<p class="text-gray-600 text-[11px] sm:text-xs mt-0.5">{{description}}</p>
				</div>
			</li>
			{{/posts}}
		</ul>
	</main>

	<footer class="flex justify-center items-center py-4 border-t-2 border-red-600 md:mx-4 text-xs sm:text-sm">
		<a href="https://replicate.com" class="text-gray-600 hover:underline">Built by Replicate</a>
		<span class="mx-2 sm:mx-4">|</span>
		<a href="https://github.com/replicate/hype" target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:underline">Fork on GitHub</a>
	</footer>

	<script>
		const currentFilter = "{{filter}}";
		const lastUpdatedTimestamp = {{lastUpdatedTimestamp}};

		function timeSince(timestamp) {
			const seconds = Math.floor((Date.now() - timestamp) / 1000);
			let interval = seconds / 31536000;
			if (interval > 1) return Math.floor(interval) + " years";
			interval = seconds / 2592000;
			if (interval > 1) return Math.floor(interval) + " months";
			interval = seconds / 86400;
			if (interval > 1) return Math.floor(interval) + " days";
			interval = seconds / 3600;
			if (interval > 1) return Math.floor(interval) + " hours";
			interval = seconds / 60;
			if (interval > 1) return Math.floor(interval) + " minutes";
			return Math.floor(seconds) + " seconds";
		}

		function updateLastUpdated() {
			const el = document.getElementById('last-updated');
			if (el && lastUpdatedTimestamp) {
				el.textContent = timeSince(lastUpdatedTimestamp) + ' ago';
			}
		}

		updateLastUpdated();
		setInterval(updateLastUpdated, 1000);

		function getSelectedSources() {
			return [...document.querySelectorAll('[data-source]:checked')].map(c => c.dataset.source);
		}

		function buildUrl(filter, sources) {
			return '/?filter=' + filter + '&sources=' + sources.join(',');
		}

		async function navigate(url) {
			document.querySelectorAll('[data-source]').forEach(cb => {
				cb.disabled = true;
				cb.parentElement.style.opacity = '0.5';
			});
			history.pushState(null, '', url);
			const res = await fetch(url);
			const html = await res.text();
			const doc = new DOMParser().parseFromString(html, 'text/html');
			document.body.innerHTML = doc.body.innerHTML;
			attachListeners();
		}

		function attachListeners() {
			document.querySelectorAll('[data-source]').forEach(cb => {
				cb.addEventListener('change', () => {
					navigate(buildUrl(currentFilter, getSelectedSources()));
				});
			});
			document.querySelectorAll('[data-navigate]').forEach(a => {
				a.addEventListener('click', (e) => {
					e.preventDefault();
					navigate(a.href);
				});
			});
		}

		window.addEventListener('popstate', () => navigate(location.href));
		attachListeners();
	</script>
</body>
</html>
